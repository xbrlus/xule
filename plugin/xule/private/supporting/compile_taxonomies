# /bin/bash

#TAXONOMIES=("usgaap-2012" "usgaap-2013" "usgaap-2014" "corpactions-2011" "corpactions-2012" "pension-2013" "pension-2014")
#TAXONOMIES=("usgaap-2012" "usgaap-2013" "usgaap-2014" "pension-2013" "pension-2014")

TAXONOMIES=("corpactions-2011" "corpactions-2012")

# TAX_ENTRY shows the entry file for each taxonomy.  It needs to be defined below
#TAX_ENTRY <- see below

PYTHON=/usr/bin/python
PYTHON3=/usr/bin/python3
ARELLE=/srv/arelle
RULESDIR=/srv/arelle/xbrlus/rules
PIKDIR=/srv/arelle/xbrlus/pik
TAXONOMYDIR=/srv/arelle/xbrlus/taxonomies

# For each taxonomy delete the pik files and recompile them based on the xsrs in the
#  rules directory
position=0
for taxonomy in "${TAXONOMIES[@]}"
do
  echo "Compiling $taxonomy"

  echo "Deleting $taxonomy pik files"
  rm -fR $PIKDIR/$taxonomy
  mkdir $PIKDIR/$taxonomy

  echo "Compiling $taxonomy files"
  YEAR=`echo $taxonomy | sed 's,.*-\(.*\),\1,'`
  TAX_ENTRY=("ca/ca-ent-all-$YEAR-05-31.xsd" "ca/ca-ent-all-2012-03-31.xsd")
  
  $PYTHON $ARELLE/arelle/plugin/xule/XuleParser.py $RULESDIR/$taxonomy $PIKDIR/$taxonomy

  $PYTHON3 $ARELLE/arelleCmdLine.py --plugins xule --xule-add-taxonomy $TAXONOMYDIR/$taxonomy --xule-taxonomy-entry ${TAX_ENTRY[$position]} --xule-rule-set $PIKDIR/$taxonomy


  # old calls 
  #/usr/local/bin/python3 $ARELLE/arelleCmdLine.py --xule-compile $RULESDIR/$taxonomy --xule-add-taxonomy $TAXONOMYDIR/$taxonomy 
  #   --xule-taxonomy-entry $TAXONOMYDIR/$taxonomy/entire/us-gaap-entryPoint-std-$YEAR-01-31.xsd --xule-rule-set $PIKDIR/$taxonomy
  #/usr/bin/python3 $ARELLE/arelleCmdLine.py --plugins xule --xule-add-taxonomy $TAXONOMYDIR/$taxonomy 
  #   --xule-taxonomy-entry "ca/ca-ent-all-$YEAR-05-31.xsd" --xule-rule-set $PIKDIR/$taxonomy
  #/usr/local/bin/python3 $ARELLE/arelleCmdLine.py --xule-add-taxonomy $TAXONOMYDIR/$taxonomy 
  #   --xule-taxonomy-entry entire/us-gaap-entryPoint-std-$YEAR-01-31.xsd --xule-rule-set $PIKDIR/$taxonomy
  #/usr/bin/python3 $ARELLE/arelleCmdLine.py --xule-add-taxonomy $TAXONOMYDIR/$taxonomy 
  #   --xule-taxonomy-entry "XBRL US Entry Points - LOCAL/xbrl-us-us-gaap-entryPoint-std-$YEAR-01-31.xsd" --xule-rule-set $PIKDIR/$taxonomy


  echo "Finished compiling $taxonomy"
  echo "=========="
  position=$(($position+1))
done

echo "*************"
